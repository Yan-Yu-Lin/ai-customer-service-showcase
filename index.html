<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI 客服系統 - 簡化版架構說明</title>
    <link rel="stylesheet" href="css/styles.css?v=2">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <nav class="navbar">
        <div class="nav-container">
            <h1 class="nav-title">AI 客服系統專案</h1>
            <ul class="nav-links">
                <li><a href="index.html" class="active">系統架構</a></li>
                <li><a href="development-log.html">開發日誌</a></li>
            </ul>
        </div>
    </nav>

    <div class="content-wrapper container">
        <aside class="toc-sidebar">
            <h3>目錄</h3>
            <ul class="toc-list">
                <li><a href="#part1">第一部分：專案說明</a>
                    <ul>
                        <li><a href="#what-is-it">這是什麼</a></li>
                        <li><a href="#problems-solved">解決什麼問題</a></li>
                        <li><a href="#how-to-integrate">如何整合</a></li>
                    </ul>
                </li>
                <li><a href="#part2">第二部分：核心功能</a>
                    <ul>
                        <li><a href="#chat-widget">AI 聊天小工具</a></li>
                        <li><a href="#admin-dashboard">管理後台功能</a></li>
                    </ul>
                </li>
                <li><a href="#part3">第三部分：技術實現</a>
                    <ul>
                        <li><a href="#tech-stack">使用的技術棧</a></li>
                        <li><a href="#architecture">系統架構圖</a></li>
                        <li><a href="#tech-details">技術細節說明</a></li>
                    </ul>
                </li>
            </ul>
        </aside>
        
        <main class="main-content">
            <header class="page-header">
                <h1>AI 客服系統專案說明</h1>
            </header>

            <section id="part1">
                <h2>第一部分：專案說明</h2>
                
                <section id="what-is-it">
                    <h3>這是什麼</h3>
                    
                    <p>這是一個 AI 客服系統，讓企業網站可以提供自動化的客戶服務。系統使用 Anthropic Claude API 來理解和回答客戶問題，前端用 Vue 3 開發聊天介面，後端用 Node.js + Express 處理 API 請求。</p>
                    
                    <p>企業只需要在網站加入一行 JavaScript 程式碼：</p>
                    <div class="code-block">
                        <pre><code>&lt;script src="https://your-domain.com/widget.js?key=YOUR_API_KEY"&gt;&lt;/script&gt;</code></pre>
                    </div>
                    
                    <p>聊天視窗就會出現在網站右下角，客戶可以直接詢問問題並獲得 AI 回答。</p>
                </section>
                
                <section id="problems-solved">
                    <h3>解決什麼問題</h3>
                    
                    <p>這個系統主要解決以下問題：</p>
                    
                    <ol>
                        <li><strong>減少人工客服工作量</strong>：自動回答常見問題，如營業時間、手續費、開戶流程等</li>
                        <li><strong>提供 24/7 服務</strong>：不受上下班時間限制，隨時可以回答客戶問題</li>
                        <li><strong>統一回答標準</strong>：基於公司提供的文件資料，確保回答內容一致且正確</li>
                    </ol>
                    
                    <p>系統會記錄所有對話，方便後續分析客戶常問的問題類型。</p>
                </section>
                
                <section id="how-to-integrate">
                    <h3>如何整合</h3>
                    
                    <p>整合過程分為三個步驟：</p>
                    
                    <ol>
                        <li><strong>註冊帳號</strong>：在管理後台註冊公司帳號，獲得 API Key</li>
                        <li><strong>上傳資料</strong>：上傳公司的 FAQ、產品說明、服務條款等文件（支援 PDF、TXT、DOCX）</li>
                        <li><strong>嵌入程式碼</strong>：將提供的 JavaScript 程式碼加入網站的 HTML 中</li>
                    </ol>
                    
                    <p>整個過程約需 10-15 分鐘即可完成。系統會自動處理上傳的文件，建立知識庫供 AI 查詢使用。</p>
                </section>
            </section>

            <section id="part2">
                <h2>第二部分：核心功能</h2>
                
                <section id="chat-widget">
                    <h3>AI 聊天小工具（Chat Widget）</h3>
                    
                    <p>聊天小工具是客戶看到並使用的介面，具有以下功能：</p>
                    
                    <h4>基本功能</h4>
                    <ul>
                        <li>浮動按鈕固定在網頁右下角，點擊展開聊天視窗</li>
                        <li>支援文字輸入和發送訊息</li>
                        <li>顯示 AI 回覆，包含打字動畫效果</li>
                        <li>保存對話歷史（使用瀏覽器 localStorage）</li>
                        <li>自動適應手機、平板、桌面螢幕尺寸</li>
                    </ul>
                    
                    <h4>AI 對話能力</h4>
                    <ul>
                        <li>理解自然語言提問，不需要特定格式</li>
                        <li>記住對話上下文，可以進行多輪對話（目前上限 10 輪）</li>
                        <li>透過 MCP (Model Context Protocol) 查詢公司文件</li>
                        <li>根據文件摘要判斷相關性，找出正確答案</li>
                        <li>無法回答時會建議聯繫人工客服</li>
                    </ul>
                    
                    <h4>技術實現</h4>
                    <ul>
                        <li>使用 Vue 3 開發，編譯成單一 JavaScript 檔案（約 200KB）</li>
                        <li>透過 WebSocket 或 HTTP 與後端 API 通訊</li>
                        <li>支援 CORS，可嵌入任何網域的網站</li>
                        <li>介面樣式隔離，不會影響原網站的 CSS</li>
                    </ul>
                    
                    <div class="visual-placeholder">
                        <p>截圖待補充：需要聊天介面的截圖，展示實際的對話畫面</p>
                    </div>
                </section>
                
                <section id="admin-dashboard">
                    <h3>管理後台功能</h3>
                    
                    <p>管理後台讓企業可以設定和管理 AI 客服系統：</p>
                    
                    <h4>文件管理</h4>
                    <ul>
                        <li>上傳公司文件（支援 PDF、TXT、DOCX 格式）</li>
                        <li>檢視已上傳的文件列表</li>
                        <li>為每個文件設定摘要（summary）</li>
                        <li>刪除或更新文件內容</li>
                        <li>系統自動產生文件索引供 AI 使用</li>
                    </ul>
                    
                    <h4>AI 測試功能</h4>
                    <ul>
                        <li>在後台直接測試 AI 的回答效果</li>
                        <li>調整 AI 的回答風格（正式/親切）</li>
                        <li>設定無法回答時的預設回覆</li>
                        <li>查看 AI 使用了哪些文件來生成答案</li>
                    </ul>
                    
                    <h4>對話記錄</h4>
                    <ul>
                        <li>查看所有客戶對話歷史</li>
                        <li>搜尋特定關鍵字的對話</li>
                        <li>匯出對話記錄（CSV 格式）</li>
                        <li>分析常見問題統計</li>
                    </ul>
                    
                    <h4>系統設定</h4>
                    <ul>
                        <li>自訂聊天視窗的顏色和標題</li>
                        <li>設定營業時間提示</li>
                        <li>管理 API Key</li>
                        <li>設定允許使用的網域（安全白名單）</li>
                    </ul>
                    
                    <div class="visual-placeholder">
                        <p>截圖待補充：需要管理後台的介面截圖，展示主要功能頁面</p>
                    </div>
                </section>
            </section>
            
            <section id="part3" class="architecture">
                <h2>第三部分：技術實現</h2>
                <section id="tech-stack">
                    <h3>使用的技術棧</h3>
                    
                    <h4>前端技術</h4>
                    <ul>
                        <li><strong>聊天小工具</strong>：Vue 3 + TypeScript，使用 Vite 打包成單一 JS 檔案</li>
                        <li><strong>管理後台</strong>：Vue 3 + Element Plus UI 框架，Vue Router 處理頁面路由</li>
                        <li><strong>狀態管理</strong>：Pinia（Vue 官方推薦的狀態管理工具）</li>
                        <li><strong>HTTP 請求</strong>：Axios 處理 API 通訊</li>
                    </ul>
                    
                    <h4>後端技術</h4>
                    <ul>
                        <li><strong>伺服器框架</strong>：Node.js + Express.js</li>
                        <li><strong>程式語言</strong>：TypeScript（提供型別檢查，減少錯誤）</li>
                        <li><strong>資料庫</strong>：PostgreSQL（儲存對話記錄、用戶資料、文件內容）</li>
                        <li><strong>認證機制</strong>：JWT（JSON Web Token）處理用戶登入狀態</li>
                        <li><strong>檔案處理</strong>：Multer 處理檔案上傳，pdf-parse 解析 PDF 文件</li>
                    </ul>
                    
                    <h4>AI 整合</h4>
                    <ul>
                        <li><strong>AI 服務</strong>：Anthropic Claude 3.5 Sonnet API</li>
                        <li><strong>實作方式</strong>：使用官方 SDK (@anthropic-ai/sdk)</li>
                        <li><strong>回應模式</strong>：支援一般回應和串流回應（Server-Sent Events）</li>
                    </ul>
                </section>
                
                <section id="architecture">
                    <h3>系統架構圖</h3>
                    
                    <div class="architecture-diagram">
                        <pre>
┌─────────────────────────────────────┐
│         客戶網站                     │
│   ┌─────────────────────┐          │
│   │  Chat Widget (Vue3) │          │
│   └──────────┬──────────┘          │
└──────────────┼─────────────────────┘
               │ HTTPS API
               ▼
┌─────────────────────────────────────┐
│      後端 API 服務器                 │
│   ┌─────────────────────┐          │
│   │   Express.js API    │          │
│   │   - /api/chat       │          │
│   │   - /api/documents  │          │
│   │   - /api/admin      │          │
│   └──────────┬──────────┘          │
└──────────────┼─────────────────────┘
               │
    ┌──────────┴──────────┐
    ▼                     ▼
┌─────────┐         ┌──────────────┐
│PostgreSQL│         │Anthropic API │
│ Database │         │  (Claude)    │
└─────────┘         └──────────────┘
                        </pre>
                    </div>
                </section>
                
                <section id="tech-details">
                    <h3>技術細節說明</h3>
                    
                    <h4>對話處理流程</h4>
                    <ol>
                        <li>用戶在聊天視窗輸入問題</li>
                        <li>前端將問題發送到後端 API（<code>POST /api/chat/message</code>）</li>
                        <li>後端從記憶體載入對話歷史（最多 10 輪）</li>
                        <li>組合 system instruction：包含文件索引（所有文件名稱和摘要）</li>
                        <li>AI 根據問題和文件摘要，使用 MCP 工具查詢相關文件</li>
                        <li>基於查詢結果生成回答</li>
                        <li>儲存對話到資料庫</li>
                        <li>回傳答案給前端顯示</li>
                    </ol>
                    
                    <h4>MCP (Model Context Protocol) 說明</h4>
                    <ul>
                        <li>AI 可以主動使用 MCP 工具與資料庫互動</li>
                        <li>MCP 工具提供的功能：
                            <ul>
                                <li>列出所有可用文件</li>
                                <li>讀取特定文件內容</li>
                                <li>搜尋文件中的關鍵資訊</li>
                            </ul>
                        </li>
                        <li>AI 透過文件摘要判斷哪些文件可能包含答案</li>
                    </ul>
                    
                    <h4>安全性設計</h4>
                    <ul>
                        <li>API Key 認證：所有請求需要有效的 API Key</li>
                        <li>CORS 設定：只允許白名單內的網域存取</li>
                        <li>輸入驗證：使用 express-validator 檢查所有輸入</li>
                        <li>SQL 注入防護：使用參數化查詢</li>
                        <li>XSS 防護：前端自動轉義所有用戶輸入</li>
                    </ul>
                    
                    <h4>效能優化</h4>
                    <ul>
                        <li>對話記憶體快取：使用 Map 結構暫存最近對話</li>
                        <li>文件索引快取：AI system instruction 包含所有文件摘要，減少查詢次數</li>
                        <li>前端資源壓縮：Widget 檔案使用 gzip 壓縮</li>
                        <li>API 回應快取：相同問題 5 分鐘內不重複呼叫 AI</li>
                    </ul>
                    
                    <h4>部署架構</h4>
                    <ul>
                        <li>單一 VPS 伺服器（2-4 核心 CPU，4-8GB RAM）</li>
                        <li>使用 PM2 管理 Node.js 程序</li>
                        <li>Nginx 反向代理處理 HTTPS</li>
                        <li>Let's Encrypt 免費 SSL 憑證</li>
                        <li>每日自動備份資料庫</li>
                    </ul>
                    
                    <div class="visual-placeholder">
                        <p>截圖待補充：需要更詳細的技術架構圖，顯示資料流向和各組件之間的關係</p>
                    </div>
                </section>
            </section>
        </main>
    </div>

    <footer class="footer">
        <p>AI 客服系統專案 &copy; 2025 - 康和證券合作專案</p>
    </footer>

    <script src="js/main.js"></script>
</body>
</html>
