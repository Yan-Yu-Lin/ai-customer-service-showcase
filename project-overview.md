# AI 客服系統專案說明

## 第一部分：專案說明

### 這是什麼

這是一個 AI 客服系統，讓企業網站可以提供自動化的客戶服務。系統使用 Anthropic Claude API 來理解和回答客戶問題，前端用 Vue 3 開發聊天介面，後端用 Node.js + Express 處理 API 請求。

企業只需要在網站加入一行 JavaScript 程式碼：
```html
<script src="https://your-domain.com/widget.js?key=YOUR_API_KEY"></script>
```

聊天視窗就會出現在網站右下角，客戶可以直接詢問問題並獲得 AI 回答。

### 解決什麼問題

這個系統主要解決以下問題：

1. **減少人工客服工作量**：自動回答常見問題，如營業時間、手續費、開戶流程等
2. **提供 24/7 服務**：不受上下班時間限制，隨時可以回答客戶問題
3. **統一回答標準**：基於公司提供的文件資料，確保回答內容一致且正確

系統會記錄所有對話，方便後續分析客戶常問的問題類型。

### 如何整合

整合過程分為三個步驟：

1. **註冊帳號**：在管理後台註冊公司帳號，獲得 API Key
2. **上傳資料**：上傳公司的 FAQ、產品說明、服務條款等文件（支援 PDF、TXT、DOCX）
3. **嵌入程式碼**：將提供的 JavaScript 程式碼加入網站的 HTML 中

整個過程約需 10-15 分鐘即可完成。系統會自動處理上傳的文件，建立知識庫供 AI 查詢使用。

---

## 第二部分：核心功能

### AI 聊天小工具（Chat Widget）

聊天小工具是客戶看到並使用的介面，具有以下功能：

**基本功能**
- 浮動按鈕固定在網頁右下角，點擊展開聊天視窗
- 支援文字輸入和發送訊息
- 顯示 AI 回覆，包含打字動畫效果
- 保存對話歷史（使用瀏覽器 localStorage）
- 自動適應手機、平板、桌面螢幕尺寸

**AI 對話能力**
- 理解自然語言提問，不需要特定格式
- 記住對話上下文，可以進行多輪對話（目前上限 10 輪）
- 透過 MCP (Model Context Protocol) 查詢公司文件
- 根據文件摘要判斷相關性，找出正確答案
- 無法回答時會建議聯繫人工客服

**技術實現**
- 使用 Vue 3 開發，編譯成單一 JavaScript 檔案（約 200KB）
- 透過 WebSocket 或 HTTP 與後端 API 通訊
- 支援 CORS，可嵌入任何網域的網站
- 介面樣式隔離，不會影響原網站的 CSS

[視覺元素說明：需要聊天介面的截圖，展示實際的對話畫面]

### 管理後台功能

管理後台讓企業可以設定和管理 AI 客服系統：

**文件管理**
- 上傳公司文件（支援 PDF、TXT、DOCX 格式）
- 檢視已上傳的文件列表
- 為每個文件設定摘要（summary）
- 刪除或更新文件內容
- 系統自動產生文件索引供 AI 使用

**AI 測試功能**
- 在後台直接測試 AI 的回答效果
- 調整 AI 的回答風格（正式/親切）
- 設定無法回答時的預設回覆
- 查看 AI 使用了哪些文件來生成答案

**對話記錄**
- 查看所有客戶對話歷史
- 搜尋特定關鍵字的對話
- 匯出對話記錄（CSV 格式）
- 分析常見問題統計

**系統設定**
- 自訂聊天視窗的顏色和標題
- 設定營業時間提示
- 管理 API Key
- 設定允許使用的網域（安全白名單）

[視覺元素說明：需要管理後台的介面截圖，展示主要功能頁面]

---

## 第三部分：技術實現

### 使用的技術棧

**前端技術**
- **聊天小工具**：Vue 3 + TypeScript，使用 Vite 打包成單一 JS 檔案
- **管理後台**：Vue 3 + Element Plus UI 框架，Vue Router 處理頁面路由
- **狀態管理**：Pinia（Vue 官方推薦的狀態管理工具）
- **HTTP 請求**：Axios 處理 API 通訊

**後端技術**
- **伺服器框架**：Node.js + Express.js
- **程式語言**：TypeScript（提供型別檢查，減少錯誤）
- **資料庫**：PostgreSQL（儲存對話記錄、用戶資料、文件內容）
- **認證機制**：JWT（JSON Web Token）處理用戶登入狀態
- **檔案處理**：Multer 處理檔案上傳，pdf-parse 解析 PDF 文件

**AI 整合**
- **AI 服務**：Anthropic Claude 3.5 Sonnet API
- **實作方式**：使用官方 SDK (@anthropic-ai/sdk)
- **回應模式**：支援一般回應和串流回應（Server-Sent Events）

### 系統架構圖

```
┌─────────────────────────────────────┐
│         客戶網站                     │
│   ┌─────────────────────┐          │
│   │  Chat Widget (Vue3) │          │
│   └──────────┬──────────┘          │
└──────────────┼─────────────────────┘
               │ HTTPS API
               ▼
┌─────────────────────────────────────┐
│      後端 API 服務器                 │
│   ┌─────────────────────┐          │
│   │   Express.js API    │          │
│   │   - /api/chat       │          │
│   │   - /api/documents  │          │
│   │   - /api/admin      │          │
│   └──────────┬──────────┘          │
└──────────────┼─────────────────────┘
               │
    ┌──────────┴──────────┐
    ▼                     ▼
┌─────────┐         ┌──────────────┐
│PostgreSQL│         │Anthropic API │
│ Database │         │  (Claude)    │
└─────────┘         └──────────────┘
```

### 技術細節說明

**對話處理流程**
1. 用戶在聊天視窗輸入問題
2. 前端將問題發送到後端 API（`POST /api/chat/message`）
3. 後端從記憶體載入對話歷史（最多 10 輪）
4. 組合 system instruction：包含文件索引（所有文件名稱和摘要）
5. AI 根據問題和文件摘要，使用 MCP 工具查詢相關文件
6. 基於查詢結果生成回答
7. 儲存對話到資料庫
8. 回傳答案給前端顯示

**MCP (Model Context Protocol) 說明**
- AI 可以主動使用 MCP 工具與資料庫互動
- MCP 工具提供的功能：
  - 列出所有可用文件
  - 讀取特定文件內容
  - 搜尋文件中的關鍵資訊
- AI 透過文件摘要判斷哪些文件可能包含答案

**安全性設計**
- API Key 認證：所有請求需要有效的 API Key
- CORS 設定：只允許白名單內的網域存取
- 輸入驗證：使用 express-validator 檢查所有輸入
- SQL 注入防護：使用參數化查詢
- XSS 防護：前端自動轉義所有用戶輸入

**效能優化**
- 對話記憶體快取：使用 Map 結構暫存最近對話
- 文件索引快取：AI system instruction 包含所有文件摘要，減少查詢次數
- 前端資源壓縮：Widget 檔案使用 gzip 壓縮
- API 回應快取：相同問題 5 分鐘內不重複呼叫 AI

**部署架構**
- 單一 VPS 伺服器（2-4 核心 CPU，4-8GB RAM）
- 使用 PM2 管理 Node.js 程序
- Nginx 反向代理處理 HTTPS
- Let's Encrypt 免費 SSL 憑證
- 每日自動備份資料庫

[視覺元素說明：需要更詳細的技術架構圖，顯示資料流向和各組件之間的關係]

---